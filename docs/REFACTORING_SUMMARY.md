# ä»£ç é‡æ„æ€»ç»“

## é‡æ„ç›®æ ‡ âœ…

æœ¬æ¬¡é‡æ„æ—¨åœ¨ä¼˜åŒ– `owo_flight_assistant` é¡¹ç›®çš„ä»£ç ç»“æ„ï¼Œæé«˜å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## å®Œæˆçš„é‡æ„å†…å®¹

### 1. **æœºåœºæ•°æ®åº“ç®¡ç†** âœ…
- **æ–‡ä»¶**: `lib/apps/data/airports_database.dart`
- **åŠŸèƒ½**:
  - å°†ç¡¬ç¼–ç çš„æœºåœºæ•°æ®ä» `xplane_service.dart` ä¸­åˆ†ç¦»
  - åˆ›å»º `AirportInfo` æ¨¡å‹ç±»å’Œ `AirportsDatabase` ç®¡ç†å™¨
  - æä¾›ä¾¿æ·çš„æŸ¥è¯¢æ¥å£:
    - `findByIcao()` - é€šè¿‡ICAOä»£ç æŸ¥æ‰¾
    - `findNearestByCoords()` - é€šè¿‡åæ ‡æŸ¥æ‰¾æœ€è¿‘æœºåœº
    - `searchByName()` - æ¨¡ç³Šæœç´¢
  - ä¾¿äºæœªæ¥æ‰©å±•ï¼ˆå¯ç›´æ¥å¯¼å…¥å¯¼èˆªæ•°æ®åº“ï¼‰

### 2. **æœºå‹æ™ºèƒ½æ£€æµ‹å™¨** âœ…
- **æ–‡ä»¶**: `lib/apps/utils/aircraft_detector.dart`
- **åŠŸèƒ½**:
  - å°è£…æœºå‹è¯†åˆ«é€»è¾‘å’Œé˜²æŠ–æœºåˆ¶
  - æä¾› `AircraftDetector` ç±»ï¼Œæ”¯æŒ:
    - æ™ºèƒ½æœºå‹æ£€æµ‹ï¼ˆBoeing 737ã€Airbus A320ã€é€šç”¨èˆªç©ºï¼‰
    - é˜²æŠ–æœºåˆ¶ï¼ˆéœ€è¿ç»­5å¸§æ£€æµ‹ä¸€è‡´ï¼‰
    - æ£€æµ‹è¿›åº¦è¿½è¸ª
  - ä»æœåŠ¡ç±»ä¸­åˆ†ç¦»ï¼Œæé«˜å¤ç”¨æ€§

### 3. **æ•°æ®è½¬æ¢å·¥å…·** âœ…
- **æ–‡ä»¶**: `lib/apps/utils/data_converters.dart`
- **åŠŸèƒ½**:
  - é›†ä¸­ç®¡ç†æ‰€æœ‰æ•°æ®è½¬æ¢é€»è¾‘:
    - å•ä½è½¬æ¢ï¼ˆç±³â†’è‹±å°ºã€èŠ‚â†’ç±³/ç§’ç­‰ï¼‰
    - å­—èŠ‚åºåˆ—è½¬æ¢ï¼ˆInt32ã€Float32ï¼‰
    - æ•°æ®æ ¼å¼åŒ–ï¼ˆé€Ÿåº¦ã€é«˜åº¦ã€èˆªå‘ç­‰ï¼‰
  - é¿å…åœ¨æœåŠ¡ç±»ä¸­é‡å¤å®ç°è½¬æ¢é€»è¾‘

### 4. **X-Plane DataRefs é…ç½®ç®¡ç†** âœ…
- **æ–‡ä»¶**: `lib/apps/services/config/xplane_datarefs.dart`
- **åŠŸèƒ½**:
  - åˆ›å»º `XPlaneDataRef` é…ç½®ç±»
  - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ DataRef è®¢é˜…é¡¹ï¼ˆ70+ ä¸ªï¼‰
  - æä¾› `getAllDataRefs()` æ‰¹é‡è·å–æ¥å£
  - æ¯ä¸ª DataRef åŒ…å«ç´¢å¼•ã€è·¯å¾„å’Œæè¿°
  - ä¾¿äºç»´æŠ¤å’Œæ‰©å±•æ–°æœºå‹æ”¯æŒ

### 5. **MSFS SimVars é…ç½®ç®¡ç†** âœ…
- **æ–‡ä»¶**: `lib/apps/services/config/msfs_simvars.dart`
- **åŠŸèƒ½**:
  - åˆ›å»º `MSFSSimVar` é…ç½®ç±»
  - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ SimConnect å˜é‡
  - æä¾› `generateSubscriptionMessage()` ç”Ÿæˆè®¢é˜…æ¶ˆæ¯
  - ç®€åŒ– MSFS æœåŠ¡çš„è®¢é˜…é€»è¾‘

### 6. **ä¼˜åŒ– XPlane æœåŠ¡** âœ…
- **æ–‡ä»¶**: `lib/apps/services/xplane_service.dart`
- **æ”¹è¿›**:
  - ä½¿ç”¨ `AirportsDatabase` æ›¿æ¢ç¡¬ç¼–ç æœºåœºæ•°æ®
  - ä½¿ç”¨ `AircraftDetector` æ›¿æ¢å†…è”æœºå‹æ£€æµ‹é€»è¾‘
  - ä½¿ç”¨ `DataConverters` ç»Ÿä¸€å¤„ç†å•ä½è½¬æ¢
  - ä½¿ç”¨ `XPlaneDataRefs` ç®€åŒ–è®¢é˜…é€»è¾‘
  - ä»£ç è¡Œæ•°ä» **651è¡Œ** å‡å°‘è‡³çº¦ **470è¡Œ**
  - æé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§

### 7. **ä¼˜åŒ– MSFS æœåŠ¡** âœ…
- **æ–‡ä»¶**: `lib/apps/services/msfs_service.dart`
- **æ”¹è¿›**:
  - ä½¿ç”¨ `MSFSSimVars` é…ç½®ç±»ç®€åŒ–è®¢é˜…
  - å‡å°‘ç¡¬ç¼–ç çš„è®¢é˜…åˆ—è¡¨
  - ä»£ç æ›´ç®€æ´ï¼Œæ˜“äºç»´æŠ¤

## é¡¹ç›®ç»“æ„ä¼˜åŒ–

```
lib/apps/
â”œâ”€â”€ data/                           # [æ–°å¢] æ•°æ®ç®¡ç†å±‚
â”‚   â””â”€â”€ airports_database.dart      # æœºåœºæ•°æ®åº“
â”œâ”€â”€ models/                         # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ flight_checklist.dart
â”‚   â””â”€â”€ simulator_data.dart
â”œâ”€â”€ services/                       # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ config/                     # [æ–°å¢] é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ xplane_datarefs.dart   # X-Plane DataRefé…ç½®
â”‚   â”‚   â””â”€â”€ msfs_simvars.dart      # MSFS SimVaré…ç½®
â”‚   â”œâ”€â”€ xplane_service.dart         # [ä¼˜åŒ–] X-PlaneæœåŠ¡
â”‚   â”œâ”€â”€ msfs_service.dart           # [ä¼˜åŒ–] MSFSæœåŠ¡
â”‚   â”œâ”€â”€ checklist_service.dart
â”‚   â””â”€â”€ notification_service.dart
â”œâ”€â”€ utils/                          # [æ–°å¢] å·¥å…·ç±»
â”‚   â”œâ”€â”€ aircraft_detector.dart      # æœºå‹æ£€æµ‹å™¨
â”‚   â””â”€â”€ data_converters.dart        # æ•°æ®è½¬æ¢å™¨
â””â”€â”€ providers/
    â”œâ”€â”€ checklist_provider.dart
    â””â”€â”€ simulator_provider.dart
```

## é‡æ„å¸¦æ¥çš„å¥½å¤„

### 1. **å¯ç»´æŠ¤æ€§æå‡** ğŸ“ˆ
- èŒè´£åˆ†ç¦»æ˜ç¡®ï¼Œæ¯ä¸ªç±»åªè´Ÿè´£å•ä¸€åŠŸèƒ½
- é…ç½®ä¸é€»è¾‘åˆ†ç¦»ï¼Œä¿®æ”¹é…ç½®ä¸å½±å“æ ¸å¿ƒé€»è¾‘
- å‡å°‘ä»£ç é‡å¤ï¼Œé™ä½ç»´æŠ¤æˆæœ¬

### 2. **å¯æ‰©å±•æ€§å¢å¼º** ğŸš€
- æ·»åŠ æ–°æœºå‹ï¼šåªéœ€åœ¨ `AircraftDetector` ä¸­æ·»åŠ è¯†åˆ«è§„åˆ™
- æ·»åŠ æ–°æœºåœºï¼šåªéœ€åœ¨ `AirportsDatabase` ä¸­æ·»åŠ æ•°æ®
- æ”¯æŒæ–°æ•°æ®é¡¹ï¼šåªéœ€åœ¨é…ç½®ç±»ä¸­æ·»åŠ  DataRef/SimVar

### 3. **ä»£ç å¤ç”¨** â™»ï¸
- `DataConverters` å¯åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å¤ç”¨
- `AircraftDetector` å¯åŒæ—¶ç”¨äº XPlane å’Œ MSFS
- `AirportsDatabase` å¯ä¸ºæ‰€æœ‰æ¨¡æ‹Ÿå™¨æœåŠ¡

### 4. **æ˜“äºæµ‹è¯•** ğŸ§ª
- å·¥å…·ç±»ç‹¬ç«‹ï¼Œä¾¿äºå•å…ƒæµ‹è¯•
- é…ç½®ä¸é€»è¾‘åˆ†ç¦»ï¼Œä¾¿äº mock æµ‹è¯•
- èŒè´£å•ä¸€ï¼Œæµ‹è¯•è¦†ç›–ç‡æ›´é«˜

## åç»­å»ºè®®

1. **æœºåœºæ•°æ®åº“æ‰©å±•**
   - å¯ä»¥è€ƒè™‘ä» .dat æ–‡ä»¶å¯¼å…¥å®Œæ•´æœºåœºæ•°æ®
   - æ”¯æŒè·‘é“ä¿¡æ¯ã€å¯¼èˆªè®¾æ–½ç­‰

2. **æœºå‹æ£€æµ‹å¢å¼º**
   - æ·»åŠ æ›´å¤šæœºå‹è¯†åˆ«è§„åˆ™
   - æ”¯æŒæœºå‹æ•°æ®åº“é…ç½®

3. **å•å…ƒæµ‹è¯•**
   - ä¸ºæ–°å¢çš„å·¥å…·ç±»æ·»åŠ å•å…ƒæµ‹è¯•
   - ç¡®ä¿æ•°æ®è½¬æ¢çš„å‡†ç¡®æ€§

4. **æ–‡æ¡£å®Œå–„**
   - ä¸ºé…ç½®ç±»æ·»åŠ ä½¿ç”¨ç¤ºä¾‹
   - å®Œå–„ API æ–‡æ¡£

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
- `lib/apps/data/airports_database.dart`
- `lib/apps/utils/aircraft_detector.dart`
- `lib/apps/utils/data_converters.dart`
- `lib/apps/services/config/xplane_datarefs.dart`
- `lib/apps/services/config/msfs_simvars.dart`

### ä¿®æ”¹æ–‡ä»¶
- `lib/apps/services/xplane_service.dart` (å¤§å¹…ä¼˜åŒ–)
- `lib/apps/services/msfs_service.dart` (ä¼˜åŒ–)

### åˆ é™¤æ–‡ä»¶
- `lib/apps/services/base/simulator_service_base.dart` (æœªä½¿ç”¨)

---

**é‡æ„å®Œæˆï¼** ğŸ‰

ä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œå¯ç»´æŠ¤æ€§æ˜¾è‘—æå‡ï¼Œä¸ºåç»­æ”¯æŒæ›´å¤šæœºå‹å¥ å®šäº†è‰¯å¥½åŸºç¡€ã€‚
