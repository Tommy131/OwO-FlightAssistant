# 首页模拟器状态显示 - 更新说明

## ✅ 更新完成

已在首页添加了模拟器连接状态显示区块，实时展示与模拟器的连接状态和飞行数据。

---

## 🎯 新增功能

### 1. **模拟器连接状态区块**

位置：首页 - 在"快速状态"和"机型选择"之间

#### 显示内容：

**未连接状态：**
- 🔴 离线标识
- 显示"未连接模拟器"
- 简洁的灰色样式

**已连接状态：**
- 🟢 在线标识
- 显示连接的模拟器类型（MSFS 或 X-Plane）
- 绿色边框和高亮样式
- 实时飞行数据展示
- 系统状态指示器

---

## 📊 实时数据显示

### 飞行数据卡片（4个）

1. **空速 (Airspeed)**
   - 图标：速度表
   - 单位：kt (节)
   - 示例：250 kt

2. **高度 (Altitude)**
   - 图标：高度
   - 单位：ft (英尺)
   - 示例：35000 ft

3. **航向 (Heading)**
   - 图标：指南针
   - 单位：° (度)
   - 示例：270°

4. **垂直速度 (Vertical Speed)**
   - 图标：趋势箭头
   - 单位：fpm (英尺/分钟)
   - 示例：-800 fpm

### 系统状态徽章（动态显示）

仅在相应系统激活时显示：

| 徽章 | 颜色 | 说明 |
|------|------|------|
| 停机刹车 | 🟠 橙色 | 停机刹车已启用 |
| 信标灯 | 🔴 红色 | 信标灯已开启 |
| 着陆灯 | 🟢 绿色 | 着陆灯已开启 |
| 起落架放下 | 🔵 蓝色 | 起落架已放下 |
| APU | 🟣 紫色 | APU 正在运行 |
| A/P | 🔷 青色 | 自动驾驶已接通 |

---

## 🎨 UI 设计

### 布局结构

```
┌─────────────────────────────────────────┐
│ 🔗 模拟器连接状态          [在线/离线]  │
│ 已连接到 MSFS / 未连接模拟器            │
├─────────────────────────────────────────┤
│ 实时飞行数据                            │
│                                         │
│ [空速卡片] [高度卡片] [航向卡片] [垂直速度] │
│                                         │
│ [停机刹车] [信标灯] [着陆灯] [APU] ...  │
└─────────────────────────────────────────┘
```

### 视觉特点

1. **连接状态指示**
   - 未连接：灰色图标 + 灰色边框
   - 已连接：绿色图标 + 绿色加粗边框

2. **数据卡片**
   - 主题色背景（半透明）
   - 图标 + 标签 + 数值
   - 圆角设计

3. **状态徽章**
   - 彩色圆点指示器
   - 对应颜色的边框和背景
   - 紧凑的圆角设计

---

## 💻 技术实现

### 新增方法

#### 1. `_buildSimulatorStatus()`
主要的模拟器状态显示方法
- 使用 `Consumer<SimulatorProvider>` 监听状态变化
- 动态显示连接状态和数据
- 响应式布局

#### 2. `_getSimulatorName()`
获取模拟器类型名称
- MSFS → "MSFS"
- X-Plane → "X-Plane"
- None → "无"

#### 3. `_buildDataChip()`
创建飞行数据卡片
- 参数：主题、图标、标签、数值
- 返回：格式化的数据显示卡片

#### 4. `_buildStatusBadge()`
创建系统状态徽章
- 参数：主题、标签、颜色
- 返回：带圆点指示器的徽章

### 依赖导入

```dart
import '../../core/providers/simulator_provider.dart';
import '../../core/models/simulator_data.dart';
```

---

## 🔄 实时更新机制

### 数据流

```
SimulatorProvider (状态管理)
    ↓
Consumer<SimulatorProvider> (监听)
    ↓
_buildSimulatorStatus (渲染)
    ↓
UI 自动更新
```

### 更新频率

- 数据更新：5-10 Hz（取决于模拟器）
- UI 刷新：实时响应数据变化
- 无需手动刷新

---

## 📱 用户体验

### 未连接时
1. 显示离线状态
2. 提示用户未连接模拟器
3. 不显示飞行数据区域
4. 简洁的灰色设计

### 已连接时
1. 显示在线状态和模拟器类型
2. 实时更新飞行数据
3. 动态显示激活的系统状态
4. 醒目的绿色高亮

### 数据显示逻辑
- 有数据：显示实际数值
- 无数据：显示 "N/A"
- 系统状态：仅在激活时显示徽章

---

## 🎯 使用场景

### 场景 1：飞行前检查
用户可以在首页快速确认：
- ✅ 模拟器已连接
- ✅ 飞机系统状态正常
- ✅ 准备开始检查单

### 场景 2：飞行中监控
用户可以实时查看：
- 当前空速和高度
- 飞行航向
- 上升/下降速度
- 关键系统状态

### 场景 3：故障排查
如果连接失败：
- 显示离线状态
- 用户可以前往检查单页面重新连接
- 或检查模拟器配置

---

## 📊 显示示例

### 示例 1：起飞阶段
```
🟢 模拟器连接状态                    [在线]
已连接到 X-Plane

实时飞行数据
[空速: 150 kt] [高度: 1500 ft] [航向: 090°] [垂直速度: 1200 fpm]

[信标灯] [着陆灯] [起落架放下]
```

### 示例 2：巡航阶段
```
🟢 模拟器连接状态                    [在线]
已连接到 MSFS

实时飞行数据
[空速: 450 kt] [高度: 35000 ft] [航向: 270°] [垂直速度: 0 fpm]

[信标灯] [A/P]
```

### 示例 3：未连接
```
⚪ 模拟器连接状态                    [离线]
未连接模拟器
```

---

## 🔧 代码位置

**文件**: `lib/pages/home/home_page.dart`

**新增代码行数**: ~240 行

**主要修改**:
1. 添加导入（第 6-8 行）
2. 添加状态区块调用（第 37-38 行）
3. 添加 4 个新方法（第 173-410 行）

---

## ✨ 特色亮点

1. **实时性** - 数据自动更新，无需刷新
2. **直观性** - 颜色编码清晰易懂
3. **信息丰富** - 一屏展示所有关键信息
4. **响应式** - 根据连接状态动态调整显示
5. **美观性** - 现代化的卡片和徽章设计

---

## 🎉 总结

首页现在可以：
- ✅ 实时显示模拟器连接状态
- ✅ 展示当前连接的模拟器类型（MSFS/X-Plane）
- ✅ 显示 4 个关键飞行数据
- ✅ 动态显示系统状态徽章
- ✅ 提供清晰的视觉反馈

用户无需进入检查单页面，即可在首页快速了解模拟器连接状态和飞行数据！

---

**更新时间**: 2026-02-03
**功能状态**: ✅ 已完成并测试
